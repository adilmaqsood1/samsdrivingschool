{% load i18n %}

<style>
  body.drivschol-dashboard-theme .dashboard-container {
    margin-top: 14px;
  }

  .drivschol-dashboard-topbar {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 16px;
    padding: 14px 16px;
    margin: 0 0 10px;
    border-radius: 16px;
    border: 1px solid rgba(109, 112, 118, 0.16);
    background: radial-gradient(900px 300px at 15% 0%, rgba(111, 190, 68, 0.26), rgba(255, 255, 255, 0.35)),
      rgba(255, 255, 255, 0.86);
    box-shadow: 0 12px 34px rgba(17, 17, 23, 0.08);
    backdrop-filter: blur(8px);
  }

  .drivschol-dashboard-topbar-title {
    display: grid;
    gap: 2px;
  }

  .drivschol-dashboard-topbar-title h1 {
    margin: 0;
    font-size: 18px;
    line-height: 1.25;
    color: var(--drivschol-heading-text, #111117);
    font-weight: 700;
  }

  .drivschol-dashboard-topbar-title .subtitle {
    font-size: 12px;
    line-height: 1.35;
    color: var(--drivschol-heading-text, #111117);
    opacity: 0.7;
  }

  .drivschol-dashboard-topbar-filters {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }

  .drivschol-dashboard-filter-label {
    font-size: 12px;
    color: var(--drivschol-heading-text, #111117);
    opacity: 0.72;
  }

  .drivschol-dashboard-select {
    appearance: none;
    background: rgba(255, 255, 255, 0.72);
    border: 1px solid rgba(109, 112, 118, 0.16);
    border-radius: 999px;
    padding: 8px 34px 8px 12px;
    font-size: 12px;
    line-height: 1.2;
    color: var(--drivschol-heading-text, #111117);
    backdrop-filter: blur(6px);
    cursor: pointer;
    outline: none;
    min-width: 160px;
  }

  .drivschol-dashboard-select:focus {
    border-color: rgba(111, 190, 68, 0.65);
    box-shadow: 0 0 0 3px rgba(111, 190, 68, 0.16);
  }
</style>

<div class="drivschol-dashboard-topbar">
  <div class="drivschol-dashboard-topbar-title">
    <h1>{% trans "Dashboard" %}</h1>
    <div class="subtitle">{% trans "Unified analytics filters" %}</div>
  </div>

  <div class="drivschol-dashboard-topbar-filters">
    <span class="drivschol-dashboard-filter-label">{% trans "Range" %}</span>
    <select id="drivschol-dashboard-range" class="drivschol-dashboard-select" data-current="{{ request.GET.dash_range|default:'180'|escape }}">
      <option value="30">{% trans "Last 30 days" %}</option>
      <option value="90">{% trans "Last 90 days" %}</option>
      <option value="180">{% trans "Last 180 days" %}</option>
      <option value="365">{% trans "Last 365 days" %}</option>
      <option value="all">{% trans "All time" %}</option>
    </select>
  </div>
</div>

<script>
  (function () {
    if (document.body && document.body.classList && !document.body.classList.contains("drivschol-dashboard-theme")) {
      document.body.classList.add("drivschol-dashboard-theme");
    }

    var sel = document.getElementById("drivschol-dashboard-range");
    if (!sel) return;

    var allowed = { "30": 1, "90": 1, "180": 1, "365": 1, "all": 1 };
    var current = sel.getAttribute("data-current") || "180";
    if (!allowed[current]) current = "180";
    sel.value = current;

    if (sel.dataset.bound === "1") return;
    sel.dataset.bound = "1";
    sel.addEventListener("change", function () {
      try {
        var url = new URL(window.location.href);
        url.searchParams.set("dash_range", sel.value);
        window.location.href = url.toString();
      } catch (e) {
        window.location.search = "?dash_range=" + encodeURIComponent(sel.value);
      }
    });
  })();
</script>

<div class="dashboard-container columns_{{ columns|length }} cf">
    {% for i in columns %}
        <div class="dashboard-column-wrapper">
            <div class="dashboard-column{% if forloop.first %} first{% endif %}">
                {% for module in modules %}
                    {% if module.model.column == i %}
                        {% include "jet.dashboard/module.html" with module=module %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</div>

<div class="dialog-confirm" id="module-remove-dialog" title="{% trans "Delete widget" %}">
    <p>{% trans "Are you sure want to delete this widget?" %}</p>
</div>

<form action="{% url "jet-dashboard:update_dashboard_modules" %}" method="POST" id="update-dashboard-modules-form">
    {% csrf_token %}
    <input type="hidden" name="app_label" value="{% if app_label %}{{ app_label }}{% endif %}">
    <input type="hidden" name="modules">
</form>

<form action="{% url "jet-dashboard:update_dashboard_module_collapse" %}" method="POST" id="update-dashboard-module-collapse-form">
    {% csrf_token %}
    <input type="hidden" name="id">
    <input type="hidden" name="collapsed">
</form>

<form action="{% url "jet-dashboard:remove_dashboard_module" %}" method="POST" id="remove-dashboard-module-form">
    {% csrf_token %}
    <input type="hidden" name="id">
</form>
